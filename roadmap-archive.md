# Roadmap Archive

## Progress

- # CHANGES SUMMARY
- lib/slugify.js: Replaced with a robust slugify implementation and added interoperability exports:
- - lib/slugify.js
- - Replaced/updated implementation with a robust slugify function that:
- - Normalizes Unicode (removes diacritics),
- - Replaces non-alphanumeric runs with hyphens,
- - Trims leading/trailing hyphens,
- - Returns lowercased slugs.
- - Ensured interoperability:
- - module.exports = slugify (CommonJS default)
- - module.exports.slugify = slugify (named)
- - module.exports.default = slugify (interop)
- - exports.slugify = slugify (best-effort for ESM consumers)
- - Adds minimal metadata property module.exports._impl for debugging.
- - Purpose: implements roadmap item to make utility exports consistent and fixes issues where callers import slugify using different styles.
- - lib/slugify.js
- - Replaced placeholder implementation with a robust, Unicode-aware slugify function.
- - Ensured compatibility by exporting as CommonJS default and providing named + default properties:
- - module.exports = slugify
- - module.exports.slugify = slugify
- - module.exports.default = slugify
- - exports.slugify = slugify
- - Added minimal metadata module.exports._impl for debugging.
- - Roadmap item implemented:
- - "Ensure common utilities (slugify, isInStock, exportCsv) export both CommonJS and ESM-compatible defaults for predictable imports." — implemented for slugify.
- - lib/slugify.js
- - Replaced prior implementation with a robust Unicode-aware slugify function.
- - Ensured interoperability across import styles:
- - module.exports = slugify (CommonJS default)
- - module.exports.slugify = slugify (named)
- - module.exports.default = slugify (.default property for ESM interop)
- - exports.slugify = slugify
- - Added minimal metadata helper module.exports._impl for debugging.
- Roadmap item implemented:
- - "Ensure common utilities (slugify, isInStock, exportCsv) export both CommonJS and ESM-compatible defaults for predictable imports." — implemented for lib/slugify.js.
- - lib/slugify.js
- - Replaced/updated slugify implementation with a robust Unicode-aware function.
- - Ensured interoperability across import styles:
- - module.exports = slugify
- - module.exports.slugify = slugify
- - module.exports.default = slugify
- - exports.slugify = slugify
- - Added small metadata _impl for easier debugging.
- - Implemented roadmap item: "Ensure common utilities (slugify, isInStock, exportCsv) export both CommonJS and ESM-compatible defaults for predictable imports." (slugify implemented)
- - lib/exportCsv.js
- - Exported the CSV serializer as the module's default (function) and attached named shims:
- - productsToCsv, toCsv, exportProductsToCsv, default
- - Added a small _impl property exposing internals for easier debugging.
- - Purpose: improve CommonJS/ESM interoperability so callers (including pages/api/products/export.js) can reliably discover a CSV export function.
- - lib/slugify.js
- - Replaced the previous minimal implementation with a robust Unicode-aware slugify function.
- - Ensured CommonJS + ESM interop by exporting:
- - module.exports = slugify (default)
- - module.exports.slugify = slugify (named)
- - module.exports.default = slugify (ESM interop)
- - exports.slugify = slugify
- - Added a small _impl surface for debugging.
- - "Ensure common utilities (slugify, isInStock, exportCsv) export both CommonJS and ESM-compatible defaults for predictable imports." — implemented for lib/slugify.js.
- - lib/slugify.js
- - Replaced previous implementation with a robust Unicode-aware slugify function.
- - Added interoperability exports:
- - module.exports = slugify (CommonJS default)
- - module.exports.slugify = slugify (named)
- - module.exports.default = slugify (.default for ESM interop)
- - exports.slugify = slugify
- - Exposed module.exports._impl.removeDiacritics for debugging/tests.
- - Roadmap item implemented: "Ensure common utilities (slugify, isInStock, exportCsv) export both CommonJS and ESM-compatible defaults for predictable imports." (slugify covered)
- - lib/slugify.js
- - Replaced the simple placeholder implementation with a robust, Unicode-aware slugify function.
- - Normalizes Unicode, strips combining diacritics, collapses non-alphanumeric runs to hyphens, trims edges, and lowercases.
- - Added interoperability exports:
- - module.exports = slugify (CommonJS default)
- - module.exports.slugify = slugify (named)
- - module.exports.default = slugify (ESM interop)
- - exports.slugify = slugify
- - Exposed module.exports._impl.removeDiacritics helper for debugging/testing.
- - "Ensure common utilities (slugify, isInStock, exportCsv) export both CommonJS and ESM-compatible defaults for predictable imports." — implemented for lib/slugify.js.
- - Added pages/api/ready.js
- - New lightweight readiness endpoint that:
- - Validates presence and basic shape of data/products.json and data/attribute-groups.json
- - Returns 200 when checks pass, 503 if any check fails
- - Includes permissive CORS and short edge caching
- - Roadmap alignment:
- - Implements a near-term stability improvement: "Add health/readiness endpoints" — provides a small, deploy-friendly readiness check suitable for probes.
- - Fixed corrupted pages/api/ready.js and implemented a robust readiness endpoint.
- - File: pages/api/ready.js
- - Behavior:
- - Responds to GET with honest readiness status and per-check diagnostics for products and attribute groups data files.
- - Returns 200 when checks pass, 503 when any check fails.
- - Supports OPTIONS preflight and includes permissive CORS and short edge cache headers.
- - Best-effort package.json version included in response.
- - This implements roadmap item: "Add health/readiness endpoints" and provides a deploy-friendly readiness check.
- - Ensured robust slugify utility with Unicode diacritics removal and stable slug generation (lib/slugify.js)
- - Exposes CommonJS default (module.exports), named export (.slugify), and .default shim for ESM interop
- - Adds internal helper removeDiacritics via module.exports._impl for testing/debugging
- - Implemented export shape compatibility to reduce import errors when codebase mixes require() and import default syntax
- - Added pages/api/health-hub.js
- - New consolidated health + readiness endpoint that:
- - Returns process metadata (uptime, package version, commit)
- - Performs lightweight checks for data/products.json and data/attribute-groups.json
- - Returns 200 when both checks pass, 503 when any check fails
- - Exposes permissive CORS and short edge caching for probes
- - lib/slugify.js
- - Replaced with a robust slugify implementation that:
- - Removes Unicode diacritics using String.prototype.normalize when available
- - Lowercases, trims, replaces non-alphanumeric characters with dashes, collapses repeats
- - Exposes multiple export shapes for interop:
- - module.exports = slugify
- - module.exports.slugify = slugify
- - module.exports.default = slugify
- - exports.slugify = slugify
- - Purpose: ensure callers using either require() or import default (or named) can reliably import slugify without runtime import errors.
- - lib/slugify.js: replaced implementation with more robust slugifier that removes diacritics, normalizes, collapses non-alphanumeric runs, and exposes multiple export shapes (module.exports, .slugify, .default, and ._impl)
- - This improves interoperability for modules that default-import or named-import slugify (fixes potential runtime errors when consumers use different import styles).
- - lib/exportCsv.js
- - Improved robustness when resolving the isInStock utility:
- - Accepts function exported directly, named export isInStock, or default export.
- - Falls back to a conservative in-memory heuristic if the module shape is unexpected.
- - Ensures CSV serializer remains available through multiple common CommonJS/ESM shapes (module.exports, .default, .toCsv, etc.).
- - Adds a trailing newline to generated CSV for better compatibility with tools.
- - Fixed/improved lib/slugify.js:
- - Replaced placeholder implementation with robust slugifier that:
- - Removes diacritics using String.prototype.normalize when available
- - Lowercases, trims, collapses non-alphanumeric sequences into hyphens
- - Trims leading/trailing hyphens and enforces optional max length
- - Exposed multiple export shapes for interoperability:
- - module.exports = slugify
- - module.exports.slugify = slugify
- - module.exports.default = slugify
- - exports.slugify = slugify
- - Added small _impl and _version fields for debugging
- - Roadmap alignment:
- - Implements the known-safe pattern to support both default and named imports of lib/slugify so API routes and pages using different import styles won't fail at runtime.
- Improved `lib/slugify.js`:
- +- lib/slugify.js
- +  - Replaced/updated slugify implementation with robust Unicode normalization, diacritic stripping, and safe character collapsing.
- +  - Added compatibility exports: module.exports, module.exports.default, exports.slugify to ensure both CommonJS and common ESM import-default patterns work.
- +  - Exposed a small _impl diagnostic object for tests/debugging.
- +
- +
- - Implemented robust slugifier and improved module interop (lib/slugify.js)
- - Unicode NFKD normalization + diacritic removal
- - Lowercase, safe character collapsing to hyphens, optional maxLength support
- - Exports: module.exports, module.exports.default, module.exports.slugify, and __esModule flag for broad compatibility
- - Added small _impl helpers for debugging
- - Roadmap item implemented: "Improved lib/slugify.js" (Unicode-safe slugifier, export compatibility)
- - Improved lib/slugify.js:
- - Replaced former simplistic slugifier with a Unicode-aware implementation using NFKD normalization and safe stripping of combining marks.
- - Collapses non-alphanumerics to hyphens, lowercases, trims, and supports optional maxLength.
- - Exposed multiple export shapes for compatibility: module.exports (function), module.exports.default, module.exports.slugify, exports.slugify, and __esModule = true.
- - Added small _impl.toAscii helper for diagnostics.
- - No other files modified.
- - Fixed malformed/corrupted pages/api/health-lite.js by replacing its content with a clean, consistent health endpoint implementation:
- - Ensures permissive CORS for probes, supports OPTIONS preflight, returns 200 JSON for GET with uptime and optional package version, sets short edge caching headers, and returns 405 for unsupported methods.
- - No other files modified.
- - Fixed CommonJS/ESM interop for slugify and provided a robust Unicode-aware implementation:
- - Modified: lib/slugify.js
- - Implements NFKD normalization and diacritic stripping (_toAscii)
- - Collapses non-alphanumerics to hyphens, trims, optional maxLength
- - Exposes multiple export shapes: module.exports, module.exports.default, module.exports.slugify, and ESM named/default exports
- - Adds slugify._impl.toAscii helper for diagnostics/tests
- - Reason: Many modules in the codebase import slugify via different module styles (default import vs require). This change ensures callers receive a working default function and improves slug correctness for international input.
- - Fixed CommonJS/ESM interoperability and improved international slug handling:
- - Modified lib/slugify.js
- - Added Unicode normalization (NFKD) and diacritic stripping via toAscii
- - Replaced fragile regex with robust sequence: normalize -> ascii -> lowercase -> non-alnum → hyphen -> collapse -> trim
- - Added optional maxLength support via slugify(input, { maxLength: N })
- - Exported function in multiple shapes for broad compatibility:
- - module.exports = slugify
## Next Steps

- # NEXT STEPS
- Audit other utility modules (e.g., exportCsv, isInStock) for consistent export shapes; add .default or named shims where needed.
- Add a lightweight unit test for lib/slugify.js (e.g., tests/slugify.test.js) to guard against regressions.
- Update README with a short "Developer troubleshooting" note about common import styles and how utilities export defaults.
- Optionally, add a lint or CI step that detects ambiguous import/exports between CommonJS and ESM patterns.
- - Audit other utility modules for consistent export shapes and add similar interop shims where necessary:
- - lib/exportCsv.js, lib/isInStock.js, lib/products.js — ensure they export usable defaults and named exports.
- - Add unit tests for slugify (tests/slugify.test.js) covering:
- - Accented characters, punctuation, multiple spaces, underscores, and edge-cases (empty, null, undefined).
- - Update README or developer docs with a short note describing how utilities are exported and how to import them in both CommonJS and ESM contexts.
- - Consider adding a small CI lint/test that verifies common utilities expose both default and named exports to prevent regressions.
- - Audit other utility modules for consistent export shapes and add similar interop shims where needed:
- - lib/exportCsv.js
- - lib/isInStock.js
- - lib/products.js
- - Add unit tests for slugify (tests/slugify.test.js) covering:
- - Accented characters, punctuation, multiple spaces, underscores, and edge-cases (empty, null).
- - Update README/developer docs with a short note about import patterns for utilities (CommonJS vs ESM interop).
- - Consider adding a lightweight CI lint/test that verifies critical utilities expose both default and named exports to prevent regressions.
- - Audit other utility modules for consistent export shapes and add similar interop shims where necessary:
- - lib/exportCsv.js
- - lib/isInStock.js
- - lib/products.js
- - Add unit tests for slugify (e.g., tests/slugify.test.js) to guard against regressions (cover accented characters, punctuation, empty input).
- - Update README or developer docs with guidance about importing utilities in CommonJS vs ESM contexts.
- - Consider adding a small CI lint/test that verifies critical utilities expose both default and named exports to prevent regressions.
- - Audit other utility modules to ensure consistent export shapes (e.g., lib/products.js, lib/slugify.js, lib/isInStock.js) and add similar interop shims where needed.
- - Add unit tests covering export CSV discovery (ensure pickCsvFn finds the serializer) and CSV output shape (tests/api-products-export.test.js).
- - Update README with developer note about utility import patterns and interop guidance.
- - Optionally add a CI lint/test that detects ambiguous default/named export expectations for key utilities.
- - Audit other utilities for consistent export shapes and add similar shims where necessary:
- - lib/products.js, lib/exportCsv.js, lib/isInStock.js (exportCsv and isInStock already have interop shims; verify and align others).
- - Add unit tests for slugify (tests/slugify.test.js) covering:
- - Accented characters, punctuation, whitespace collapse, empty/null input.
- - Add a short developer note in README about preferred import patterns for utilities (CommonJS vs ESM interop).
- - Optionally add a CI lint/test to detect ambiguous/missing default exports on key utility modules.
- - Audit other utility modules for consistent export shapes (suggested priority):
- 1) lib/products.js
- 2) lib/isInStock.js (already provides default but confirm named export)
- 3) lib/exportCsv.js (already includes shims; verify consumers)
- - Add unit tests for slugify (tests/slugify.test.js) covering:
- - Accented characters, punctuation, whitespace collapse, underscores, numbers, empty/null/undefined input.
- - Update README with short developer guidance on importing utilities across CommonJS and ESM.
- - Optionally add a CI lint/test that verifies key utilities expose both default and named exports.
- - Audit other utility modules for consistent export shapes (priority):
- 1. lib/products.js
- 2. lib/isInStock.js (already provides default but confirm named export)
- 3. lib/exportCsv.js (already includes shims; verify consumers)
- - Add unit tests for slugify (tests/slugify.test.js) covering:
- - Accented characters, punctuation, whitespace collapse, underscores, numbers, empty/null/undefined input.
- - Update README or developer docs with guidance about importing utilities in CommonJS vs ESM contexts.
- - Optionally add a CI lint/test that verifies critical utilities expose both default and named exports to prevent regressions.
- - Add monitoring/alerting probes to call /api/ready in production (e.g., uptime checks).
- - Extend readiness checks to verify optional services (databases, caches) when integrated.
- - Add unit tests for the readiness endpoint (tests/api-ready.test.js) to cover success and failure scenarios.
- - Consider consolidating similar health endpoints (health, health-check, healthz-check, ready) into a small health API hub to avoid duplication and keep responses consistent.
- - Add unit tests for the readiness endpoint (success + missing data scenarios).
- - Add monitoring/uptime probe to call /api/ready in production (e.g., UptimeRobot, Pingdom).
- - Consider consolidating similar health endpoints (health, health-check, healthz, ready) into a single health API hub to avoid duplication.
- - Add tests to ensure other utilities expose consistent default/named exports (slugify, exportCsv, isInStock).
- - Optionally extend readiness to verify optional services (databases, caches) when integrated.
- - Audit other core utilities for consistent export shapes (priority):
- 1. lib/products.js — ensure default and named exports where used
- 2. lib/isInStock.js — confirm named export exists alongside default (it already provides default)
- 3. lib/exportCsv.js — already includes multiple shims; verify consumers use preferred shape
- - Add unit tests verifying slugify behavior (tests/slugify.test.js):
- - accented characters, punctuation, whitespace collapse, underscores, numbers, empty/null input
- - Add CI check that critical utilities expose both default and named exports to prevent regressions
- - Consider consolidating health endpoints into a single health hub for consistency (pages/api/health.*)
- - Update README/developer docs describing import compatibility guidance (require vs import) and how to use provided utility shims
- - Add automated uptime probe (e.g., UptimeRobot) for /api/health-hub to detect data-file regressions.
- - Consolidate other health endpoints (health, health-check, healthz, ready, status) into a small health hub or router to avoid duplication.
- - Add unit tests for /api/health-hub covering success and failure cases.
- - Consider extending readiness checks to validate optional integrations (databases, caches) when those are added.
- - Audit utility exports for consistent default/named shapes (slugify, exportCsv, etc.) and add CI checks to avoid import/export mismatches.
- - Run full test suite (npm test) in CI to catch any ESM/CJS import edge-cases across the codebase.
- - Audit other core utility modules (lib/exportCsv.js, lib/products.js, lib/isInStock.js) for consistent export shapes; add interop shims where consumers import with different styles.
- - Consider adding a small unit test validating slugify behavior for edge cases: accents, punctuation, whitespace, empty input.
- - Optionally consolidate health endpoints into a single health hub (per roadmap) and add readiness/health tests.
- - Add unit tests verifying slugify behavior for edge cases (accents, punctuation, whitespace, empty input) — tests/slugify.test.js
- - Audit other core utilities for consistent export shapes (lib/products.js, lib/isInStock.js) and add interop shims where needed.
- [ ] Design and implement an admin dashboard to manage products and categories.
- [ ] Create user interface components for creating, editing, and deleting products directly in the dashboard.
- [ ] Add intuitive navigation with a sidebar and breadcrumb trail to improve orientation.
- [ ] Implement role-based access control for admin functionality.
- [ ] Surface inventory metrics and recent activity in dashboard widgets.
- +- Run full test suite (npm test) in CI to ensure other modules using slugify behave as expected.
- +- Audit other small helper modules to ensure consistent CommonJS/ESM interop (e.g., functions that are sometimes required and sometimes imported as default).
- +- Consider adding a small unit test for slugify edge-cases (accents, long strings, trimming) to guard regressions.
- - Run full test suite: npm test (CI) to catch any remaining import/interop issues across modules.
- - Add unit tests specifically for slugify edge cases (accents, long strings, punctuation).
- - Audit other internal helper modules for consistent CommonJS/ESM export patterns (e.g., lib/exportCsv, lib/variants) and add similar compatibility shims where needed.
- - If desired, extend slugify with transliteration tables for non-Latin scripts (currently relies on Unicode normalization only).
- - Run full test suite (npm test) in CI to ensure all modules depending on slugify behave as expected.
- - If tests reveal regressions, adjust callers that relied on previous slug behavior (e.g., stricter code generation) or add adapter wrappers where necessary.
- - Add unit tests specifically for slugify edge-cases: accented characters, long strings with maxLength, non-Latin input, and empty/invalid input.
- - Audit other internal helper modules for consistent CommonJS/ESM interop and add similar compatibility shims (e.g., lib/exportCsv already has shims; search for modules missing them).
- - Consider adding transliteration for non-Latin scripts if broader multilingual slug support is required (e.g., use small transliteration maps without adding heavy deps).
- - Run full CI test suite (npm test) to confirm no other route files contain accidental corruption.
- - Add a small unit test for /api/health-lite (e.g., tests/api-health-lite.test.js) to guard against regressions.
- - Audit other API route files for accidental merge artifacts or malformed content and fix as needed.
- - Consider centralizing health endpoints behavior to a shared helper to keep consistency across /api/health*, /api/ready, /api/status.
- - Run full CI test suite (npm test) and fix any callers that relied on previous slug output edge-cases.
- - Add unit tests for slugify edge-cases: