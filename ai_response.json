{
  "files": [
    {
      "path": "pages/admin/attribute-groups-flat.js",
      "content": "import React from 'react';\n\nexport default function AdminAttributeGroupsFlatPage() {\n  const [state, setState] = React.useState({ loading: true, error: null, data: null });\n\n  React.useEffect(() => {\n    let cancelled = false;\n    async function load() {\n      setState({ loading: true, error: null, data: null });\n      try {\n        const res = await fetch('/api/attribute-groups/flat');\n        if (!res.ok) throw new Error(`Failed to load: ${res.status}`);\n        const json = await res.json();\n        if (!cancelled) setState({ loading: false, error: null, data: json });\n      } catch (err) {\n        if (!cancelled) setState({ loading: false, error: err.message || 'Failed to load', data: null });\n      }\n    }\n    load();\n    return () => {\n      cancelled = true;\n    };\n  }, []);\n\n  const count = state.data?.count || 0;\n  const items = Array.isArray(state.data?.attributes) ? state.data.attributes : [];\n\n  return (\n    <div style={container}>\n      <div style={headerRow}>\n        <h1 style={{ margin: 0 }}>Attribute Groups (Flat)</h1>\n        <a href=\"/api/attribute-groups/flat/export\" style={btnPrimary}>Export CSV</a>\n      </div>\n\n      {state.loading && <p>Loadingâ€¦</p>}\n      {state.error && <p style={{ color: '#b91c1c' }}>Error: {state.error}</p>}\n\n      {state.data && (\n        <div>\n          <p style={{ color: '#374151' }}>Found {count} attribute{count === 1 ? '' : 's'}.</p>\n          {items.length > 0 ? (\n            <ul style={list}>\n              {items.map((a, idx) => (\n                <li key={`${a.groupId || a.groupName || 'g'}-${a.code || idx}`} style={listItem}>\n                  <div style={{ display: 'flex', alignItems: 'center', gap: 8, flexWrap: 'wrap' }}>\n                    <strong>{a.name || a.code}</strong>\n                    {a.code ? <code style={codeBadge}>{a.code}</code> : null}\n                    {a.groupName ? <span style={pill}>{a.groupName}</span> : null}\n                    {a.type ? <span style={typePill}>{a.type}</span> : null}\n                    {a.required === true ? <span style={requiredPill}>required</span> : <span style={optionalPill}>optional</span>}\n                  </div>\n                </li>\n              ))}\n            </ul>\n          ) : (\n            <p style={{ color: '#6b7280' }}>No attributes.</p>\n          )}\n        </div>\n      )}\n    </div>\n  );\n}\n\nconst container = { padding: 20, maxWidth: 960, margin: '0 auto' };\nconst headerRow = { display: 'flex', alignItems: 'center', justifyContent: 'space-between', marginBottom: 12 };\nconst list = { listStyle: 'none', padding: 0, margin: 0, display: 'flex', flexDirection: 'column', gap: 8 };\nconst listItem = { border: '1px solid #e5e7eb', borderRadius: 8, padding: 12, background: '#fff' };\nconst codeBadge = { background: '#eef2ff', color: '#3730a3', padding: '2px 6px', borderRadius: 4, fontFamily: 'monospace', fontSize: 12 };\nconst pill = { background: '#f1f5f9', color: '#0f172a', padding: '2px 6px', borderRadius: 999, fontSize: 12 };\nconst typePill = { background: '#ecfeff', color: '#155e75', padding: '2px 6px', borderRadius: 999, fontSize: 12 };\nconst requiredPill = { background: '#ecfdf5', color: '#065f46', padding: '2px 6px', borderRadius: 999, fontSize: 12 };\nconst optionalPill = { background: '#f3f4f6', color: '#374151', padding: '2px 6px', borderRadius: 999, fontSize: 12 };\nconst btnPrimary = { textDecoration: 'none', background: '#111827', color: '#fff', padding: '8px 12px', borderRadius: 6 };\n"
    },
    {
      "path": "tests/admin-attribute-groups-flat-page.test.js",
      "content": "import React from 'react';\nimport { render, screen, waitFor } from '@testing-library/react';\nimport Page from '../pages/admin/attribute-groups-flat';\n\ndescribe('Admin Attribute Groups Flat page', () => {\n  beforeEach(() => {\n    global.fetch = jest.fn(async () => ({\n      ok: true,\n      json: async () => ({\n        count: 2,\n        attributes: [\n          { groupId: 'seo', groupName: 'SEO', code: 'meta_title', name: 'Meta Title', type: 'text', required: true },\n          { groupId: 'shipping', groupName: 'Shipping', code: 'weight', name: 'Weight', type: 'number', required: false },\n        ],\n      }),\n    }));\n  });\n\n  afterEach(() => {\n    jest.resetAllMocks();\n  });\n\n  it('renders flattened attributes and export link', async () => {\n    render(<Page />);\n\n    expect(screen.getByText('Attribute Groups (Flat)')).toBeInTheDocument();\n\n    await waitFor(() => expect(global.fetch).toHaveBeenCalledWith('/api/attribute-groups/flat'));\n\n    expect(await screen.findByText('Meta Title')).toBeInTheDocument();\n    expect(screen.getByText('SEO')).toBeInTheDocument();\n    expect(screen.getByText('Weight')).toBeInTheDocument();\n    expect(screen.getByText(/Found 2 attributes/)).toBeInTheDocument();\n\n    const exportLink = screen.getByText('Export CSV');\n    expect(exportLink.getAttribute('href')).toBe('/api/attribute-groups/flat/export');\n  });\n});\n"
    },
    {
      "path": "README.md",
      "content": "# Simple PIM (Next.js)\n\nThis is a lightweight Product Information Management (PIM) demo built with Next.js and deployed on Vercel. It includes sample data, APIs for products, tags, attributes, attribute groups, and a minimal admin UI.\n\n## Quick start\n\n- Install dependencies: `npm install`\n- Dev server: `npm run dev`\n- Run tests: `npm test`\n\n## Notable features\n\n- Product search, tag filtering, and CSV export on the storefront (home page)\n- Admin dashboard with product stats and tools\n- Attributes and Attribute Groups management and exports\n- Flat Attribute Groups browser with CSV export at `/admin/attribute-groups-flat`\n- Tag stats and bulk tag tools\n- Variant generation helpers\n- Per-product flat attributes viewer at `/admin/product/[sku]/attributes` (uses `/api/products/[sku]/attributes/flat`)\n\n## New: Admin Products filters and CSV export\n\nThe Admin Products page now mirrors the storefront filtering experience:\n\n- Search by name, SKU, or description\n- Filter by tags and in-stock only\n- CSV export link that always reflects the current filters\n- All filters are synced to the URL for easy sharing and reproducible exports\n\nYou can find it at `/admin/products`.\n\n## API\n\nExplore the API routes under `/pages/api/*`. Common ones include:\n\n- `/api/products`, `/api/products/[sku]`, `/api/products/search`, `/api/products/export`\n- `/api/products/[sku]/attributes/flat` (flatten a product's Attribute Groups for easy export/inspection)\n- `/api/tags`, `/api/tags/stats`, `/api/tags/export`\n- `/api/attributes`, `/api/attributes/suggest`\n- `/api/attribute-groups`, `/api/attribute-groups/flat`, `/api/attribute-groups/export`\n\n## Testing\n\nThis project uses Jest and Testing Library. When adding features, ensure you:\n\n- Cover new behavior with tests\n- Keep the main branch green (tests and build passing)\n\nRun tests with `npm test`.\n"
    }
  ]
}